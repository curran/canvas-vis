//@ sourceMappingURL=Relation.map
// Generated by CoffeeScript 1.6.1
(function() {

  define(['cv/expose'], function(expose) {
    var Attribute, Relation, Tuple;
    Relation = Backbone.Model.extend({
      initialize: function() {
        this.attributes = new Backbone.Collection;
        this.tuples = new Backbone.Collection;
        return this.attrCounter = 0;
      },
      addAttribute: function(name) {
        var attribute;
        attribute = new Attribute({
          name: name,
          index: this.attrCounter++
        });
        this.attributes.add(attribute);
        return attribute;
      },
      attrByName: function(name) {
        return this.attributes.find(function(attr) {
          return attr.name === name;
        });
      },
      addTuple: function(values) {
        return this.tuples.add(new Tuple({
          values: values
        }));
      },
      computeMinMax: function() {
        var _this = this;
        return this.attributes.each(function(attr) {
          var maxTuple, minTuple;
          minTuple = _this.tuples.min(function(tuple) {
            return tuple.value(attr);
          });
          maxTuple = _this.tuples.max(function(tuple) {
            return tuple.value(attr);
          });
          if (minTuple !== Infinity) {
            attr.min = minTuple.value(attr);
            return attr.max = maxTuple.value(attr);
          }
        });
      },
      select: function(test) {
        var newRelation;
        newRelation = new Relation;
        newRelation.attributes = this.attributes;
        newRelation.tuples.add(this.tuples.filter(test));
        return newRelation;
      },
      project: function(attributes) {
        var newRelation;
        newRelation = new Relation;
        newRelation.attributes.add(attributes);
        newRelation.tuples = this.tuples;
        return newRelation;
      },
      renameAttribute: function(oldName, newName) {
        var newRelation;
        newRelation = new Relation;
        this.attributes.each(function(attribute) {
          var newAttr;
          if (attribute.name === oldName) {
            newAttr = attribute.rename(newName);
            return newRelation.attributes.add(newAttr);
          } else {
            return newRelation.attributes.add(attribute);
          }
        });
        newRelation.tuples = this.tuples;
        return newRelation;
      }
    });
    Tuple = Backbone.Model.extend({
      initialize: function() {
        return expose(this, 'values');
      },
      value: function(attr) {
        return this.values[attr.index];
      }
    });
    Attribute = Backbone.Model.extend({
      initialize: function() {
        return expose(this, 'name', 'min', 'max', 'index');
      },
      rename: function(newName) {
        return new Attribute({
          name: newName,
          min: this.min,
          max: this.max,
          index: this.index
        });
      }
    });
    Relation.Attribute = Attribute;
    Relation.Tuple = Tuple;
    return Relation;
  });

}).call(this);
